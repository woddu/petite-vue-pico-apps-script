<script type="module">
    import { createApp, reactive } from 'https://unpkg.com/petite-vue?module'

    const columns = [
        'description',
        'code',
        'size',
        'color',
        'quantity',
        'sold',
        'remarks',
        'date'
    ];

    const state = reactive({
        isLoading: true,
        isEditing: false,
        showWarningModal: false,
        data: [
            {
                description: "Sample Item",
                code: "ITEM001",
                size: "M",
                color: "Red",
                quantity: 10,
                sold: 2,
                remarks: "New stock",
                date: "2023-10-01"
            },
            {
                description: "Another Item",
                code: "ITEM002",
                size: "L",
                color: "Blue",
                quantity: 5,
                sold: 1,
                remarks: "Limited edition",
                date: "2023-10-02"
            }
        ]
    });

    const item = reactive({
        description: "",
        code: "",
        size: "",
        color: "",
        quantity: 0,
        sold: 0,
        remarks: "",
        date: ""
    });

    google.script.run
        .withSuccessHandler((incomingData) => {
            const fresh = JSON.parse(incomingData)          
            state.data.splice(0, state.data.length, ...fresh)
            state.isLoading = false;
        })
        .withFailureHandler((error) => {
            console.error('Error fetching data:', error);
        })
        .getData();
    //setTimeout(() => {
    //    state.isLoading = false;
    //}, 100);
    createApp({
        state,
        item,
        page_size: 4,
        page_number: 1,
        last_page: 0,
        query: '',
        columns,
        sortKey: '',
        sortOrders: columns.reduce((o, key) => ((o[key] = 1), o), {}),

        get filteredData() {
            const sortKey = this.sortKey
            const filterKey = this.query && this.query.toLowerCase()
            const order = this.sortOrders[sortKey] || 1
            let data = state.data
            if (filterKey) {
                data = data.filter((row) => {
                    return Object.keys(row).some((key) => {
                        return String(row[key]).toLowerCase().indexOf(filterKey) > -1
                    })
                })
            }
            if (sortKey) {
                data = data.slice().sort((a, b) => {
                    a = a[sortKey]
                    b = b[sortKey]
                    return (a === b ? 0 : a > b ? 1 : -1) * order
                })
            }
            this.last_page = Math.ceil(data.length / this.page_size)
            return data.slice((this.page_number - 1) * this.page_size, this.page_number * this.page_size);
        },


        sortBy(key) {
            this.sortKey = key
            this.sortOrders[key] = this.sortOrders[key] * -1
        },

        capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1)
        },

        dateFormat(dateString) {
            const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

    }).mount()
</script>